<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Éê„É≥„ÉâÊ¥ªÂãï„Éè„Éñ üé∏</title>
    
    <!-- „Éï„Ç°„Éì„Ç≥„É≥Ë®≠ÂÆö -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='80' font-size='80'>üé∏</text></svg>">
    
    <!-- React/Babel/Tailwind -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;500;700;800&display=swap');
        
        body { 
            font-family: 'M PLUS Rounded 1c', sans-serif;
            background: #1a1a2e;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 119, 232, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(255, 232, 119, 0.2) 0%, transparent 50%);
            color: #ffffff;
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }
        
        .feature-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .feature-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #f093fb 50%, #f5576c 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .status-online {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #4ade80;
            border-radius: 50%;
            box-shadow: 0 0 10px #4ade80;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.1); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            33% { transform: translateY(-10px) rotate(-3deg); }
            66% { transform: translateY(-10px) rotate(3deg); }
        }
        
        @keyframes slide-up {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .float-animation { animation: float 6s ease-in-out infinite; }
        .slide-up { animation: slide-up 0.6s ease-out forwards; }
        
        .quick-info-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            min-height: 140px;
        }
        
        .line-clamp-2 {
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }
    </style>
</head>
<body>
    <div id="root">
        <div style="display: flex; justify-content: center; align-items: center; min-height: 100vh; color: white;">
            Ë™≠„ÅøËæº„Åø‰∏≠...
        </div>
    </div>
    
    <script type="text/babel">
        const { useState, useEffect, createElement: h } = React;

        // FirebaseË®≠ÂÆöÔºàÊèê‰æõ„Åï„Çå„ÅüÂÆüÈöõ„ÅÆË®≠ÂÆöÔºâ
        const firebaseConfig = {
            apiKey: "AIzaSyDkO7o1e8PNc9seMoMk3eBytSOIOA_Rqaw",
            authDomain: "band-apps.firebaseapp.com",
            databaseURL: "https://band-apps-default-rtdb.firebaseio.com",
            projectId: "band-apps",
            storageBucket: "band-apps.firebasestorage.app",
            messagingSenderId: "238355659055",
            appId: "1:238355659055:web:d07caffb8b2fd6112689da",
            measurementId: "G-T5ZYHTSS3L"
        };

        // FirebaseÂàùÊúüÂåñ
        let firebaseInitialized = false;
        let database = null;

        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            firebaseInitialized = true;
            console.log("FirebaseÂàùÊúüÂåñÊàêÂäü");
        } catch (error) {
            console.error("FirebaseÂàùÊúüÂåñ„Ç®„É©„Éº:", error);
        }

        const BandHub = () => {
            const [currentTime, setCurrentTime] = useState(new Date());
            const [connectionStatus, setConnectionStatus] = useState('Á¢∫Ë™ç‰∏≠...');
            const [onlineUsers, setOnlineUsers] = useState(0);
            const [nextSchedule, setNextSchedule] = useState(null);
            const [recentUpdate, setRecentUpdate] = useState(null);
            const [recentPost, setRecentPost] = useState(null);
            const [sessionId] = useState(() => Math.random().toString(36).substr(2, 9));

            // Ê©üËÉΩ„Ç´„Éº„Éâ‰∏ÄË¶ß
            const features = [
                {
                    id: 'schedule',
                    title: '„Çπ„Ç±„Ç∏„É•„Éº„É´',
                    description: 'Á∑¥Áøí„Éª„É©„Ç§„ÉñÊó•Á®ã',
                    icon: 'üìÖ',
                    url: 'schedule.html',
                    color: 'from-blue-500 to-cyan-500',
                    bgColor: 'rgba(59, 130, 246, 0.2)'
                },
                {
                    id: 'setlist',
                    title: '„Çª„ÉÉ„Éà„É™„Çπ„Éà',
                    description: '„É©„Ç§„Éñ„ÅÆÊõ≤È†ÜÁÆ°ÁêÜ',
                    icon: 'üé∏',
                    url: 'setlist.html',
                    color: 'from-purple-500 to-indigo-500',
                    bgColor: 'rgba(139, 92, 246, 0.2)'
                },
                {
                    id: 'members',
                    title: '„É°„É≥„Éê„Éº„ÉªÊ©üÊùê',
                    description: '„É°„É≥„Éê„ÉºÊÉÖÂ†±„Å®Ê©üÊùê',
                    icon: 'üë•',
                    url: 'members.html',
                    color: 'from-green-500 to-teal-500',
                    bgColor: 'rgba(34, 197, 94, 0.2)'
                },
                {
                    id: 'finance',
                    title: 'ÂèéÊîØÁÆ°ÁêÜ',
                    description: '„ÅäÈáë„ÅÆÁÆ°ÁêÜ',
                    icon: 'üí∞',
                    url: 'finance.html',
                    color: 'from-yellow-500 to-orange-500',
                    bgColor: 'rgba(250, 204, 21, 0.2)'
                },
                {
                    id: 'board',
                    title: 'Êé≤Á§∫Êùø',
                    description: 'ÈÄ£Áµ°‰∫ãÈ†Ö„Éª„Éï„Ç°„Ç§„É´ÂÖ±Êúâ',
                    icon: 'üìù',
                    url: 'board.html',
                    color: 'from-red-500 to-pink-500',
                    bgColor: 'rgba(239, 68, 68, 0.2)'
                }
            ];

            // ÊôÇË®à„ÅÆÊõ¥Êñ∞
            useEffect(() => {
                const timer = setInterval(() => {
                    setCurrentTime(new Date());
                }, 1000);
                return () => clearInterval(timer);
            }, []);

            // FirebaseÊé•Á∂öÁä∂ÊÖã„ÅÆÁõ£Ë¶ñ
            useEffect(() => {
                if (!firebaseInitialized || !database) {
                    setConnectionStatus('„É≠„Éº„Ç´„É´„É¢„Éº„Éâ');
                    return;
                }

                const presenceRef = database.ref('.info/connected');
                const userRef = database.ref(`presence/${sessionId}`);
                
                presenceRef.on('value', (snapshot) => {
                    if (snapshot.val() === true) {
                        userRef.set(true);
                        userRef.onDisconnect().remove();
                        setConnectionStatus('„Ç™„É≥„É©„Ç§„É≥');
                    } else {
                        setConnectionStatus('„Ç™„Éï„É©„Ç§„É≥');
                    }
                });

                // „Ç™„É≥„É©„Ç§„É≥„É¶„Éº„Ç∂„ÉºÊï∞„ÅÆÁõ£Ë¶ñ
                const allUsersRef = database.ref('presence');
                allUsersRef.on('value', (snapshot) => {
                    const users = snapshot.val() || {};
                    setOnlineUsers(Object.keys(users).length);
                });

                return () => {
                    if (database) {
                        presenceRef.off();
                        allUsersRef.off();
                        userRef.remove();
                    }
                };
            }, [sessionId]);

            // Firebase„Åã„Çâ„Éá„Éº„Çø„ÇíÂèñÂæó
            useEffect(() => {
                if (!firebaseInitialized || !database) return;

                try {
                    // „Çπ„Ç±„Ç∏„É•„Éº„É´„Éá„Éº„Çø„ÅÆÁõ£Ë¶ñ
                    const schedulesRef = database.ref('schedules');
                    schedulesRef.on('value', (snapshot) => {
                        const data = snapshot.val() || {};
                        const now = new Date();
                        let nextEvent = null;
                        let nearestDate = null;

                        // Ê¨°„ÅÆ‰∫àÂÆö„ÇíÊé¢„Åô
                        Object.entries(data).forEach(([dateKey, events]) => {
                            const eventDate = new Date(dateKey);
                            if (eventDate >= now && events) {
                                Object.values(events).forEach(event => {
                                    if (event && event.date) {
                                        const eventDateTime = new Date(`${event.date} ${event.time || '00:00'}`);
                                        if (!nearestDate || eventDateTime < nearestDate) {
                                            nearestDate = eventDateTime;
                                            nextEvent = {
                                                title: event.title || '‰∫àÂÆö',
                                                date: `${new Date(event.date).toLocaleDateString('ja-JP', { month: 'numeric', day: 'numeric' })} ${event.time || ''}`,
                                                location: event.location || ''
                                            };
                                        }
                                    }
                                });
                            }
                        });

                        setNextSchedule(nextEvent);
                    });

                    // Êé≤Á§∫Êùø„ÅÆÊúÄÊñ∞ÊäïÁ®ø„ÇíÁõ£Ë¶ñ
                    const boardRef = database.ref('board/posts');
                    boardRef.on('value', (snapshot) => {
                        const posts = snapshot.val() || {};
                        let latestPost = null;
                        let latestTime = 0;

                        // ÊúÄÊñ∞„ÅÆÊäïÁ®ø„ÇíÊé¢„Åô
                        Object.values(posts).forEach(post => {
                            if (post && post.createdAt > latestTime) {
                                latestTime = post.createdAt;
                                const timeDiff = Date.now() - post.createdAt;
                                const timeAgo = timeDiff < 60000 ? '‰ªä' :
                                             timeDiff < 3600000 ? `${Math.floor(timeDiff / 60000)}ÂàÜÂâç` :
                                             timeDiff < 86400000 ? `${Math.floor(timeDiff / 3600000)}ÊôÇÈñìÂâç` :
                                             `${Math.floor(timeDiff / 86400000)}Êó•Ââç`;
                                
                                latestPost = {
                                    title: post.title || '',
                                    content: post.content || '',
                                    author: post.author || '',
                                    time: timeAgo
                                };
                            }
                        });

                        if (latestPost) {
                            setRecentPost(latestPost);
                        }
                    });

                    // ÊúÄÊñ∞„ÅÆÊõ¥Êñ∞„ÇíÁõ£Ë¶ñÔºà„Ç∑„É≥„Éó„É´ÁâàÔºâ
                    setRecentUpdate({
                        type: '„Ç∑„Çπ„ÉÜ„É†',
                        content: '„Åô„Åπ„Å¶Ê≠£Â∏∏„Å´Âãï‰Ωú‰∏≠',
                        time: '‰ªä'
                    });

                } catch (error) {
                    console.error('„Éá„Éº„ÇøÂèñÂæó„Ç®„É©„Éº:', error);
                }

                return () => {
                    if (database) {
                        database.ref('schedules').off();
                        database.ref('board/posts').off();
                    }
                };
            }, []);

            const formatTime = (date) => {
                return date.toLocaleTimeString('ja-JP', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
            };

            const formatDate = (date) => {
                return date.toLocaleDateString('ja-JP', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    weekday: 'long'
                });
            };

            return (
                <div className="min-h-screen">
                    {/* „Éò„ÉÉ„ÉÄ„Éº */}
                    <header className="glass-card mx-4 mt-4 lg:mx-auto lg:max-w-7xl">
                        <div className="p-6">
                            <div className="flex flex-col lg:flex-row justify-between items-center gap-4">
                                <div className="text-center lg:text-left">
                                    <h1 className="text-4xl font-bold gradient-text mb-2">
                                        üé∏ „Éê„É≥„ÉâÊ¥ªÂãï„Éè„Éñ
                                    </h1>
                                    <p className="text-gray-300">
                                        „Åô„Åπ„Å¶„ÅÆÊ¥ªÂãï„Çí„Åì„Åì„Åã„Çâ
                                    </p>
                                </div>
                                <div className="text-center lg:text-right">
                                    <div className="text-3xl font-bold text-white mb-1">
                                        {formatTime(currentTime)}
                                    </div>
                                    <div className="text-sm text-gray-400">
                                        {formatDate(currentTime)}
                                    </div>
                                    <div className="flex items-center justify-center lg:justify-end gap-2 mt-2">
                                        <span className="status-online"></span>
                                        <span className="text-sm text-gray-300">
                                            {connectionStatus}
                                        </span>
                                        {onlineUsers > 0 && (
                                            <span className="text-sm text-gray-400">
                                                ({onlineUsers}‰∫∫)
                                            </span>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ */}
                    <main className="container mx-auto px-4 py-8 max-w-7xl">
                        {/* „ÇØ„Ç§„ÉÉ„ÇØÊÉÖÂ†±„Çª„ÇØ„Ç∑„Éß„É≥ */}
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                            {/* ÊúÄÊñ∞„ÅÆÊé≤Á§∫ÊùøÊäïÁ®ø */}
                            <div className="quick-info-card slide-up">
                                <h3 className="text-lg font-bold mb-3 flex items-center gap-2">
                                    <span>üìù</span>
                                    Êé≤Á§∫Êùø
                                </h3>
                                {recentPost ? (
                                    <div>
                                        <p className="text-xl font-bold text-pink-400">
                                            {recentPost.title}
                                        </p>
                                        <p className="text-gray-300 text-sm mt-1 line-clamp-2">
                                            {recentPost.content}
                                        </p>
                                        <p className="text-sm text-gray-400 mt-2">
                                            {recentPost.author} - {recentPost.time}
                                        </p>
                                    </div>
                                ) : (
                                    <p className="text-gray-400">
                                        Êñ∞„Åó„ÅÑÊäïÁ®ø„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì
                                    </p>
                                )}
                            </div>
                            
                            {/* Ê¨°„ÅÆ‰∫àÂÆö */}
                            <div className="quick-info-card slide-up" style={{ animationDelay: '0.1s' }}>
                                <h3 className="text-lg font-bold mb-3 flex items-center gap-2">
                                    <span>üìç</span>
                                    Ê¨°„ÅÆ‰∫àÂÆö
                                </h3>
                                {nextSchedule ? (
                                    <div>
                                        <p className="text-xl font-bold text-cyan-400">
                                            {nextSchedule.title}
                                        </p>
                                        <p className="text-gray-300">
                                            {nextSchedule.date}
                                        </p>
                                        <p className="text-sm text-gray-400">
                                            {nextSchedule.location}
                                        </p>
                                    </div>
                                ) : (
                                    <p className="text-gray-400">
                                        ‰∫àÂÆö„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì
                                    </p>
                                )}
                            </div>

                            {/* ÊúÄÊñ∞„ÅÆÊõ¥Êñ∞ */}
                            <div className="quick-info-card slide-up" style={{ animationDelay: '0.2s' }}>
                                <h3 className="text-lg font-bold mb-3 flex items-center gap-2">
                                    <span>üîî</span>
                                    ÊúÄÊñ∞„ÅÆÊõ¥Êñ∞
                                </h3>
                                {recentUpdate ? (
                                    <div>
                                        <p className="text-sm text-pink-400 font-medium">
                                            {recentUpdate.type}
                                        </p>
                                        <p className="text-gray-300">
                                            {recentUpdate.content}
                                        </p>
                                        <p className="text-sm text-gray-500">
                                            {recentUpdate.time}
                                        </p>
                                    </div>
                                ) : (
                                    <p className="text-gray-400">
                                        Êõ¥Êñ∞„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì
                                    </p>
                                )}
                            </div>
                        </div>

                        {/* Ê©üËÉΩ„Ç∞„É™„ÉÉ„Éâ */}
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {features.map((feature, index) => (
                                <div
                                    key={feature.id}
                                    className="feature-card p-6 slide-up"
                                    style={{ 
                                        animationDelay: `${0.2 + index * 0.1}s`,
                                        background: feature.bgColor
                                    }}
                                    onClick={() => {
                                        window.location.href = feature.url;
                                    }}
                                >
                                    <div className="text-5xl mb-4 float-animation">
                                        {feature.icon}
                                    </div>
                                    <h3 className={`text-xl font-bold mb-2 bg-gradient-to-r ${feature.color} bg-clip-text text-transparent`}>
                                        {feature.title}
                                    </h3>
                                    <p className="text-gray-300 text-sm mb-4">
                                        {feature.description}
                                    </p>
                                    <span className={`inline-block px-3 py-1 bg-gradient-to-r ${feature.color} text-white text-xs rounded-full`}>
                                        Âà©Áî®ÂèØËÉΩ
                                    </span>
                                </div>
                            ))}
                        </div>
                    </main>

                    {/* „Éï„ÉÉ„Çø„Éº */}
                    <footer className="mt-12 pb-8 text-center text-gray-400 text-sm">
                        <p>
                            üé∏ Band Apps ¬© 2024 | 
                            <span className="text-gray-500"> Made with ‚ù§Ô∏è for Musicians</span>
                        </p>
                    </footer>
                </div>
            );
        };

        // „Ç¢„Éó„É™„Çí„É¨„É≥„ÉÄ„É™„É≥„Ç∞
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(BandHub));
    </script>
</body>
</html>
