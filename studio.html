# Studio.html éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ã®æ”¹å–„ææ¡ˆ

## 1. éå»ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã®é‡ãªã‚Šå•é¡Œã®ä¿®æ­£

CSSã§é©åˆ‡ãªä½™ç™½ã‚’è¨­å®šã—ã€ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã«ã—ã¾ã™ï¼š

```css
.session-list {
    max-height: 400px;
    overflow-y: auto;
    padding: 10px;
}

.session-item {
    margin-bottom: 10px;
    padding: 15px;
    border-radius: 8px;
    background: rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
}

.session-item:hover {
    background: rgba(255, 255, 255, 0.15);
    transform: translateX(5px);
}
```

## 2. éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®ç®¡ç†æ–¹æ³•ã®ææ¡ˆ

### A. **ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼ˆæ¨å¥¨ï¼‰**

å°ã•ã„ãƒ•ã‚¡ã‚¤ãƒ«ã¯Firebase Storageã€å¤§ãã„ãƒ•ã‚¡ã‚¤ãƒ«ã¯å¤–éƒ¨ãƒªãƒ³ã‚¯ã‚’ä½¿ç”¨ï¼š

```javascript
const AudioManager = {
    // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã®é–¾å€¤ï¼ˆ10MBï¼‰
    MAX_DIRECT_UPLOAD_SIZE: 10 * 1024 * 1024,
    
    // éŸ³å£°ã‚½ãƒ¼ã‚¹ã®ç¨®é¡
    SOURCE_TYPE: {
        FIREBASE: 'firebase',
        GOOGLE_DRIVE: 'google_drive',
        YOUTUBE: 'youtube',
        SOUNDCLOUD: 'soundcloud',
        EXTERNAL_URL: 'external_url'
    },
    
    // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†
    async handleAudioUpload(file, method = 'auto') {
        if (method === 'auto') {
            if (file.size <= this.MAX_DIRECT_UPLOAD_SIZE) {
                return await this.uploadToFirebase(file);
            } else {
                return await this.promptExternalLink();
            }
        }
        
        switch (method) {
            case 'firebase':
                return await this.uploadToFirebase(file);
            case 'link':
                return await this.promptExternalLink();
            default:
                throw new Error('Invalid upload method');
        }
    },
    
    // Firebaseã¸ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
    async uploadToFirebase(file) {
        const storageRef = firebase.storage().ref();
        const audioRef = storageRef.child(`audio/${Date.now()}_${file.name}`);
        const snapshot = await audioRef.put(file);
        const downloadURL = await snapshot.ref.getDownloadURL();
        
        return {
            type: this.SOURCE_TYPE.FIREBASE,
            url: downloadURL,
            name: file.name,
            size: file.size,
            duration: await this.getAudioDuration(file)
        };
    },
    
    // å¤–éƒ¨ãƒªãƒ³ã‚¯ã®å…¥åŠ›ã‚’ä¿ƒã™
    async promptExternalLink() {
        // ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤º
        const link = await this.showLinkModal();
        const sourceType = this.detectSourceType(link);
        
        return {
            type: sourceType,
            url: link,
            name: this.extractFileName(link),
            size: null,
            duration: null
        };
    },
    
    // ãƒªãƒ³ã‚¯ã®ç¨®é¡ã‚’åˆ¤å®š
    detectSourceType(url) {
        if (url.includes('drive.google.com')) {
            return this.SOURCE_TYPE.GOOGLE_DRIVE;
        } else if (url.includes('youtube.com') || url.includes('youtu.be')) {
            return this.SOURCE_TYPE.YOUTUBE;
        } else if (url.includes('soundcloud.com')) {
            return this.SOURCE_TYPE.SOUNDCLOUD;
        }
        return this.SOURCE_TYPE.EXTERNAL_URL;
    },
    
    // Google Driveã®å…±æœ‰ãƒªãƒ³ã‚¯ã‚’ç›´æ¥å†ç”Ÿå¯èƒ½ãªURLã«å¤‰æ›
    convertGoogleDriveUrl(shareUrl) {
        // å…±æœ‰ãƒªãƒ³ã‚¯ã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«IDã‚’æŠ½å‡º
        const match = shareUrl.match(/\/d\/([a-zA-Z0-9-_]+)/);
        if (match) {
            const fileId = match[1];
            return `https://drive.google.com/uc?export=download&id=${fileId}`;
        }
        return shareUrl;
    }
};
```

### B. **UIå®Ÿè£…ä¾‹**

```javascript
const AudioUploadComponent = () => {
    const [uploadMethod, setUploadMethod] = useState('auto');
    const [audioSources, setAudioSources] = useState([]);
    
    const handleDrop = async (e) => {
        e.preventDefault();
        const files = Array.from(e.dataTransfer.files);
        
        for (const file of files) {
            if (file.type.startsWith('audio/')) {
                const audioData = await AudioManager.handleAudioUpload(file, uploadMethod);
                setAudioSources(prev => [...prev, audioData]);
            }
        }
    };
    
    const handleLinkAdd = async () => {
        const audioData = await AudioManager.promptExternalLink();
        setAudioSources(prev => [...prev, audioData]);
    };
    
    return (
        <div>
            {/* ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ–¹æ³•ã®é¸æŠ */}
            <div className="upload-method-selector">
                <label>
                    <input 
                        type="radio" 
                        value="auto" 
                        checked={uploadMethod === 'auto'}
                        onChange={(e) => setUploadMethod(e.target.value)}
                    />
                    è‡ªå‹•ï¼ˆ10MBä»¥ä¸‹ã¯ç›´æ¥ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼‰
                </label>
                <label>
                    <input 
                        type="radio" 
                        value="firebase" 
                        checked={uploadMethod === 'firebase'}
                        onChange={(e) => setUploadMethod(e.target.value)}
                    />
                    å¸¸ã«Firebaseã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
                </label>
                <label>
                    <input 
                        type="radio" 
                        value="link" 
                        checked={uploadMethod === 'link'}
                        onChange={(e) => setUploadMethod(e.target.value)}
                    />
                    å¤–éƒ¨ãƒªãƒ³ã‚¯ã‚’ä½¿ç”¨
                </label>
            </div>
            
            {/* ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã‚¨ãƒªã‚¢ */}
            <div 
                className="drop-zone"
                onDrop={handleDrop}
                onDragOver={(e) => e.preventDefault()}
            >
                <p>éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—</p>
                <p>ã¾ãŸã¯</p>
                <button onClick={handleLinkAdd}>
                    å¤–éƒ¨ãƒªãƒ³ã‚¯ã‚’è¿½åŠ 
                </button>
            </div>
            
            {/* éŸ³æºãƒªã‚¹ãƒˆ */}
            <div className="audio-sources">
                {audioSources.map((source, index) => (
                    <AudioSourceItem key={index} source={source} />
                ))}
            </div>
        </div>
    );
};
```

### C. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ **

```javascript
// Firebaseãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ§‹é€ 
{
    sessions: {
        sessionId: {
            name: "ã‚»ãƒƒã‚·ãƒ§ãƒ³å",
            date: "2025-01-01",
            recordings: [
                {
                    id: "recording1",
                    type: "firebase",
                    url: "https://firebasestorage.googleapis.com/...",
                    name: "ãƒœãƒ¼ã‚«ãƒ«.mp3",
                    size: 5242880,
                    duration: 180
                },
                {
                    id: "recording2",
                    type: "google_drive",
                    url: "https://drive.google.com/file/d/...",
                    name: "ã‚®ã‚¿ãƒ¼.mp3",
                    size: null,
                    duration: null
                }
            ]
        }
    }
}
```

## 3. å®Ÿè£…ã®åˆ©ç‚¹

### ğŸ¯ **ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®å‘ä¸Š**
- å°ã•ã„ãƒ•ã‚¡ã‚¤ãƒ«ã¯å³åº§ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- å¤§ãã„ãƒ•ã‚¡ã‚¤ãƒ«ã¯å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã‚’æ´»ç”¨
- æŸ”è»Ÿãªé¸æŠè‚¢ã‚’æä¾›

### ğŸ’° **ã‚³ã‚¹ãƒˆæœ€é©åŒ–**
- Firebase Storageã®ä½¿ç”¨é‡ã‚’å‰Šæ¸›
- å¸¯åŸŸå¹…ã‚³ã‚¹ãƒˆã®ç¯€ç´„
- ç„¡æ–™æ å†…ã§ã®é‹ç”¨ãŒå¯èƒ½

### ğŸš€ **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**
- ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ™‚é–“ã®çŸ­ç¸®
- ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å†ç”Ÿã®ã‚µãƒãƒ¼ãƒˆ
- CDNçµŒç”±ã§ã®é«˜é€Ÿé…ä¿¡

### ğŸ”§ **å®Ÿè£…ã®ç°¡å˜ã•**
- æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰ã¸ã®çµ±åˆãŒå®¹æ˜“
- æ®µéšçš„ãªç§»è¡ŒãŒå¯èƒ½
- ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãŒç°¡å˜

## 4. è¿½åŠ ã®æœ€é©åŒ–æ¡ˆ

### A. **éŸ³å£°åœ§ç¸®**
```javascript
// Web Audio APIã‚’ä½¿ç”¨ã—ãŸåœ§ç¸®
async function compressAudio(file) {
    const audioContext = new AudioContext();
    const audioBuffer = await file.arrayBuffer();
    const decodedAudio = await audioContext.decodeAudioData(audioBuffer);
    
    // ãƒ“ãƒƒãƒˆãƒ¬ãƒ¼ãƒˆã‚’ä¸‹ã’ã¦åœ§ç¸®
    // å®Ÿè£…ã¯åˆ¥é€”ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨
}
```

### B. **ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**
```javascript
// å¤§ããªãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†å‰²ã—ã¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
async function uploadInChunks(file, chunkSize = 1024 * 1024) {
    const chunks = Math.ceil(file.size / chunkSize);
    
    for (let i = 0; i < chunks; i++) {
        const start = i * chunkSize;
        const end = Math.min(start + chunkSize, file.size);
        const chunk = file.slice(start, end);
        
        // ãƒãƒ£ãƒ³ã‚¯ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
        await uploadChunk(chunk, i, chunks);
    }
}
```

### C. **ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°æˆ¦ç•¥**
```javascript
// IndexedDBã‚’ä½¿ç”¨ã—ãŸãƒ­ãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥
const AudioCache = {
    async saveToCache(audioData) {
        const db = await this.openDB();
        const transaction = db.transaction(['audio'], 'readwrite');
        const store = transaction.objectStore('audio');
        await store.put(audioData);
    },
    
    async getFromCache(audioId) {
        const db = await this.openDB();
        const transaction = db.transaction(['audio'], 'readonly');
        const store = transaction.objectStore('audio');
        return await store.get(audioId);
    }
};
