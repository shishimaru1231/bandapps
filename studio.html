<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Çπ„Çø„Ç∏„Ç™ - „Éê„É≥„ÉâÊ¥ªÂãïÁÆ°ÁêÜ</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='80' font-size='80'>üé∏</text></svg>">
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;500;700;800&display=swap');
        
        body { 
            font-family: 'M PLUS Rounded 1c', sans-serif;
            background: #1a1a2e;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(139, 92, 246, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 119, 232, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(255, 232, 119, 0.2) 0%, transparent 50%);
            color: #ffffff;
            min-height: 100vh;
            margin: 0;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #f093fb 50%, #f5576c 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .session-list {
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
        }
        
        .session-item {
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .session-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(5px);
        }
        
        .drop-zone {
            border: 2px dashed rgba(139, 92, 246, 0.5);
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            transition: all 0.3s ease;
            background: rgba(139, 92, 246, 0.1);
            margin: 20px 0;
        }
        
        .drop-zone.drag-over {
            border-color: rgba(139, 92, 246, 1);
            background: rgba(139, 92, 246, 0.2);
        }
        
        .audio-source-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .upload-method-selector {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .upload-method-selector label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 8px 16px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }
        
        .upload-method-selector label:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .upload-method-selector input[type="radio"] {
            cursor: pointer;
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: #1a1a2e;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .input-field {
            width: 100%;
            padding: 12px;
            margin-bottom: 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            outline: none;
            transition: all 0.3s ease;
        }
        
        .input-field:focus {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(139, 92, 246, 0.8);
        }
        
        .btn-primary {
            background: rgba(139, 92, 246, 0.9);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .btn-primary:hover {
            background: rgba(139, 92, 246, 1);
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .auth-container {
            max-width: 400px;
            margin: 100px auto;
            padding: 20px;
        }
        
        .error-message {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid rgba(255, 0, 0, 0.3);
            color: #ff6b6b;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #667eea, #f093fb);
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel" data-type="module">
        //<![CDATA[
        const { useState, useEffect, useRef } = React;

        // FirebaseË®≠ÂÆö - ÂÖÉ„ÅÆÂÄ§„ÇíÂæ©ÂÖÉ
        const firebaseConfig = {
            apiKey: "AIzaSyDkO7o1e8PNc9seMoMk3eBytSOIOA_Rqaw",
            authDomain: "band-apps.firebaseapp.com",
            databaseURL: "https://band-apps-default-rtdb.firebaseio.com",
            projectId: "band-apps",
            storageBucket: "band-apps.firebasestorage.app",
            messagingSenderId: "238355659055",
            appId: "1:238355659055:web:d07caffb8b2fd6112689da",
            measurementId: "G-T5ZYHTSS3L"
        };

        // „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Çí‰ΩøÁî®„Åó„Åü„É¢„ÉÉ„ÇØ„Çπ„Éà„É¨„Éº„Ç∏
        const MockStorage = {
            sessions: JSON.parse(localStorage.getItem('band_sessions') || '{}'),
            
            saveSessions() {
                localStorage.setItem('band_sessions', JSON.stringify(this.sessions));
            },
            
            addSession(session) {
                const id = Date.now().toString();
                this.sessions[id] = { ...session, id };
                this.saveSessions();
                return id;
            },
            
            updateSession(id, data) {
                if (this.sessions[id]) {
                    this.sessions[id] = { ...this.sessions[id], ...data };
                    this.saveSessions();
                }
            },
            
            deleteSession(id) {
                delete this.sessions[id];
                this.saveSessions();
            },
            
            getSessions() {
                return Object.values(this.sessions);
            }
        };

        let database = null;
        let storage = null;
        let auth = null;
        let isFirebaseEnabled = false;
        
        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            storage = firebase.storage();
            auth = firebase.auth();
            isFirebaseEnabled = true;
        } catch (error) {
            console.error("Firebase initialization error:", error);
            console.log("„É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„É¢„Éº„Éâ„ÅßÂãï‰Ωú„Åó„Åæ„Åô");
        }

        const AudioManager = {
            MAX_DIRECT_UPLOAD_SIZE: 10 * 1024 * 1024, // 10MB
            
            SOURCE_TYPE: {
                FIREBASE: 'firebase',
                GOOGLE_DRIVE: 'google_drive',
                YOUTUBE: 'youtube',
                SOUNDCLOUD: 'soundcloud',
                EXTERNAL_URL: 'external_url',
                LOCAL: 'local'
            },
            
            async handleAudioUpload(file, method = 'auto') {
                if (!isFirebaseEnabled) {
                    return { needsExternalLink: true };
                }
                
                if (method === 'auto') {
                    if (file.size <= this.MAX_DIRECT_UPLOAD_SIZE) {
                        return await this.uploadToFirebase(file);
                    } else {
                        return { needsExternalLink: true };
                    }
                }
                
                if (method === 'firebase') {
                    if (file.size > 50 * 1024 * 1024) {
                        throw new Error('„Éï„Ç°„Ç§„É´„Çµ„Ç§„Ç∫„ÅåÂ§ß„Åç„Åô„Åé„Åæ„ÅôÔºàÊúÄÂ§ß50MBÔºâ');
                    }
                    return await this.uploadToFirebase(file);
                }
                
                return { needsExternalLink: true };
            },
            
            async uploadToFirebase(file) {
                if (!storage) throw new Error('Firebase„Çπ„Éà„É¨„Éº„Ç∏„ÅåÂà©Áî®„Åß„Åç„Åæ„Åõ„Çì');
                
                const storageRef = storage.ref();
                const audioRef = storageRef.child(`audio/${Date.now()}_${file.name}`);
                const snapshot = await audioRef.put(file);
                const downloadURL = await snapshot.ref.getDownloadURL();
                
                return {
                    type: this.SOURCE_TYPE.FIREBASE,
                    url: downloadURL,
                    name: file.name,
                    size: file.size,
                    duration: null
                };
            },
            
            detectSourceType(url) {
                if (url.includes('drive.google.com')) {
                    return this.SOURCE_TYPE.GOOGLE_DRIVE;
                } else if (url.includes('youtube.com') || url.includes('youtu.be')) {
                    return this.SOURCE_TYPE.YOUTUBE;
                } else if (url.includes('soundcloud.com')) {
                    return this.SOURCE_TYPE.SOUNDCLOUD;
                }
                return this.SOURCE_TYPE.EXTERNAL_URL;
            },
            
            convertGoogleDriveUrl(shareUrl) {
                const match = shareUrl.match(/\/d\/([a-zA-Z0-9-_]+)/);
                if (match) {
                    const fileId = match[1];
                    return `https://drive.google.com/uc?export=download&id=${fileId}`;
                }
                return shareUrl;
            },
            
            processExternalLink(url, name) {
                const sourceType = this.detectSourceType(url);
                let processedUrl = url;
                
                if (sourceType === this.SOURCE_TYPE.GOOGLE_DRIVE) {
                    processedUrl = this.convertGoogleDriveUrl(url);
                }
                
                return {
                    type: sourceType,
                    url: processedUrl,
                    name: name || this.extractFileName(url),
                    size: null,
                    duration: null
                };
            },
            
            extractFileName(url) {
                try {
                    const urlObj = new URL(url);
                    const pathname = urlObj.pathname;
                    const parts = pathname.split('/');
                    return decodeURIComponent(parts[parts.length - 1]) || 'Â§ñÈÉ®Èü≥Ê∫ê';
                } catch {
                    return 'Â§ñÈÉ®Èü≥Ê∫ê';
                }
            }
        };

        const AuthComponent = ({ onLogin }) => {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [isLogin, setIsLogin] = useState(true);
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setError('');
                setLoading(true);

                try {
                    if (!isFirebaseEnabled) {
                        onLogin({ email, uid: 'local-user' });
                        return;
                    }

                    if (isLogin) {
                        await auth.signInWithEmailAndPassword(email, password);
                    } else {
                        await auth.createUserWithEmailAndPassword(email, password);
                    }
                } catch (error) {
                    setError(error.message);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="auth-container glass-card">
                    <h2 className="text-2xl font-bold mb-6 text-center gradient-text">
                        {isLogin ? '„É≠„Ç∞„Ç§„É≥' : 'Êñ∞Ë¶èÁôªÈå≤'}
                    </h2>
                    
                    {error && <div className="error-message">{error}</div>}
                    
                    <form onSubmit={handleSubmit}>
                        <input
                            type="email"
                            placeholder="„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ"
                            value={email}
                            onChange={(e) => setEmail(e.target.value)}
                            className="input-field"
                            required
                        />
                        
                        <input
                            type="password"
                            placeholder="„Éë„Çπ„ÉØ„Éº„Éâ"
                            value={password}
                            onChange={(e) => setPassword(e.target.value)}
                            className="input-field"
                            required
                            minLength="6"
                        />
                        
                        <button 
                            type="submit" 
                            className="btn-primary w-full mb-4"
                            disabled={loading}
                        >
                            {loading ? (
                                <span className="loading-spinner"></span>
                            ) : (
                                isLogin ? '„É≠„Ç∞„Ç§„É≥' : 'ÁôªÈå≤'
                            )}
                        </button>
                    </form>
                    
                    <p className="text-center text-sm">
                        {isLogin ? '„Ç¢„Ç´„Ç¶„É≥„Éà„Çí„ÅäÊåÅ„Å°„Åß„Å™„ÅÑÊñπ„ÅØ' : '„Åô„Åß„Å´„Ç¢„Ç´„Ç¶„É≥„Éà„Çí„ÅäÊåÅ„Å°„ÅÆÊñπ„ÅØ'}
                        <button
                            onClick={() => setIsLogin(!isLogin)}
                            className="text-purple-400 hover:text-purple-300 ml-1"
                        >
                            {isLogin ? 'Êñ∞Ë¶èÁôªÈå≤' : '„É≠„Ç∞„Ç§„É≥'}
                        </button>
                    </p>

                    {!isFirebaseEnabled && (
                        <p className="text-center text-sm text-yellow-400 mt-4">
                            „Éá„É¢„É¢„Éº„Éâ: „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Çí‰ΩøÁî®„Åó„Å¶„ÅÑ„Åæ„Åô
                        </p>
                    )}
                </div>
            );
        };

        const StudioApp = () => {
            const [user, setUser] = useState(null);
            const [sessions, setSessions] = useState([]);
            const [currentSession, setCurrentSession] = useState(null);
            const [audioSources, setAudioSources] = useState([]);
            const [uploadMethod, setUploadMethod] = useState('auto');
            const [showLinkModal, setShowLinkModal] = useState(false);
            const [externalLink, setExternalLink] = useState('');
            const [externalLinkName, setExternalLinkName] = useState('');
            const [uploading, setUploading] = useState(false);
            const [dragOver, setDragOver] = useState(false);
            const fileInputRef = useRef(null);

            useEffect(() => {
                if (isFirebaseEnabled && auth) {
                    const unsubscribe = auth.onAuthStateChanged((user) => {
                        setUser(user);
                    });
                    return () => unsubscribe();
                } else {
                    const localUser = localStorage.getItem('local_user');
                    if (localUser) {
                        setUser(JSON.parse(localUser));
                    }
                }
            }, []);

            useEffect(() => {
                if (!user) return;

                if (isFirebaseEnabled && database) {
                    const userSessionsRef = database.ref(`users/${user.uid}/sessions`);
                    userSessionsRef.on('value', (snapshot) => {
                        const data = snapshot.val() || {};
                        const sessionsArray = Object.entries(data).map(([id, session]) => ({
                            id,
                            ...session
                        }));
                        setSessions(sessionsArray.sort((a, b) => new Date(b.date) - new Date(a.date)));
                    });

                    return () => userSessionsRef.off();
                } else {
                    const loadSessions = () => {
                        const sessionsArray = MockStorage.getSessions();
                        setSessions(sessionsArray.sort((a, b) => new Date(b.date) - new Date(a.date)));
                    };
                    loadSessions();
                    
                    window.addEventListener('storage', loadSessions);
                    return () => window.removeEventListener('storage', loadSessions);
                }
            }, [user]);

            const handleLogin = (userData) => {
                if (!isFirebaseEnabled) {
                    localStorage.setItem('local_user', JSON.stringify(userData));
                    setUser(userData);
                }
            };

            const handleLogout = () => {
                if (isFirebaseEnabled && auth) {
                    auth.signOut();
                } else {
                    localStorage.removeItem('local_user');
                    setUser(null);
                }
            };

            const createNewSession = () => {
                const newSession = {
                    name: `„Çª„ÉÉ„Ç∑„Éß„É≥ ${new Date().toLocaleDateString('ja-JP')}`,
                    date: new Date().toISOString(),
                    recordings: []
                };
                
                if (isFirebaseEnabled && database) {
                    const newRef = database.ref(`users/${user.uid}/sessions`).push();
                    newRef.set(newSession);
                    setCurrentSession({ id: newRef.key, ...newSession });
                } else {
                    const id = MockStorage.addSession(newSession);
                    setCurrentSession({ id, ...newSession });
                    const sessionsArray = MockStorage.getSessions();
                    setSessions(sessionsArray.sort((a, b) => new Date(b.date) - new Date(a.date)));
                }
                setAudioSources([]);
            };

            const handleDrop = async (e) => {
                e.preventDefault();
                setDragOver(false);
                
                const files = Array.from(e.dataTransfer.files);
                await handleFiles(files);
            };

            const handleFileInput = async (e) => {
                const files = Array.from(e.target.files);
                await handleFiles(files);
            };

            const handleFiles = async (files) => {
                for (const file of files) {
                    if (file.type.startsWith('audio/')) {
                        setUploading(true);
                        try {
                            const result = await AudioManager.handleAudioUpload(file, uploadMethod);
                            
                            if (result.needsExternalLink) {
                                alert(`„Éï„Ç°„Ç§„É´„Äå${file.name}„Äç„ÅØ${(file.size / 1024 / 1024).toFixed(1)}MB„Åß„Åô„ÄÇÂ§ñÈÉ®„É™„É≥„ÇØ„Çí‰ΩøÁî®„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`);
                                setShowLinkModal(true);
                            } else {
                                setAudioSources(prev => [...prev, result]);
                                saveToSession(result);
                            }
                        } catch (error) {
                            console.error('Upload error:', error);
                            alert('„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Ç®„É©„Éº: ' + error.message);
                        } finally {
                            setUploading(false);
                        }
                    }
                }
            };

            const handleExternalLinkAdd = () => {
                if (!externalLink) return;
                
                const audioData = AudioManager.processExternalLink(externalLink, externalLinkName);
                setAudioSources(prev => [...prev, audioData]);
                saveToSession(audioData);
                
                setShowLinkModal(false);
                setExternalLink('');
                setExternalLinkName('');
            };

            const saveToSession = (audioData) => {
                if (!currentSession) return;
                
                const recordings = [...(currentSession.recordings || []), audioData];
                
                if (isFirebaseEnabled && database) {
                    database.ref(`users/${user.uid}/sessions/${currentSession.id}/recordings`).set(recordings);
                } else {
                    MockStorage.updateSession(currentSession.id, { recordings });
                }
            };

            const loadSession = (session) => {
                setCurrentSession(session);
                setAudioSources(session.recordings || []);
            };

            const deleteAudioSource = (index) => {
                const newSources = audioSources.filter((_, i) => i !== index);
                setAudioSources(newSources);
                
                if (currentSession) {
                    if (isFirebaseEnabled && database) {
                        database.ref(`users/${user.uid}/sessions/${currentSession.id}/recordings`).set(newSources);
                    } else {
                        MockStorage.updateSession(currentSession.id, { recordings: newSources });
                    }
                }
            };

            const deleteSession = (sessionId) => {
                if (confirm('„Åì„ÅÆ„Çª„ÉÉ„Ç∑„Éß„É≥„ÇíÂâäÈô§„Åó„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü')) {
                    if (isFirebaseEnabled && database) {
                        database.ref(`users/${user.uid}/sessions/${sessionId}`).remove();
                    } else {
                        MockStorage.deleteSession(sessionId);
                        setSessions(MockStorage.getSessions());
                    }
                    
                    if (currentSession?.id === sessionId) {
                        setCurrentSession(null);
                        setAudioSources([]);
                    }
                }
            };

            if (!user) {
                return <AuthComponent onLogin={handleLogin} />;
            }

            return (
                <div className="min-h-screen p-4">
                    <header className="glass-card mb-6 p-6">
                        <div className="flex justify-between items-center">
                            <div>
                                <h1 className="text-3xl font-bold gradient-text mb-2">
                                    üéµ „É¨„Ç≥„Éº„Éá„Ç£„É≥„Ç∞„Çπ„Çø„Ç∏„Ç™
                                </h1>
                                {currentSession && (
                                    <p className="text-xl">
                                        ÁèæÂú®„ÅÆ„Çª„ÉÉ„Ç∑„Éß„É≥: {currentSession.name}
                                    </p>
                                )}
                            </div>
                            <div className="flex gap-4">
                                <button
                                    onClick={createNewSession}
                                    className="btn-primary"
                                >
                                    Êñ∞Ë¶è„Çª„ÉÉ„Ç∑„Éß„É≥
                                </button>
                                <a
                                    href="home.html"
                                    className="btn-secondary"
                                    style={{ textDecoration: 'none', display: 'inline-block' }}
                                >
                                    „Éõ„Éº„É†„Å´Êàª„Çã
                                </a>
                                <button
                                    onClick={handleLogout}
                                    className="btn-secondary"
                                >
                                    „É≠„Ç∞„Ç¢„Ç¶„Éà
                                </button>
                            </div>
                        </div>
                    </header>

                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div className="glass-card p-6">
                            <h2 className="text-xl font-bold mb-4">ÈÅéÂéª„ÅÆ„Çª„ÉÉ„Ç∑„Éß„É≥</h2>
                            <div className="session-list">
                                {sessions.map(session => (
                                    <div
                                        key={session.id}
                                        className={`session-item ${currentSession?.id === session.id ? 'border-2 border-purple-500' : ''}`}
                                    >
                                        <div onClick={() => loadSession(session)}>
                                            <p className="font-medium">{session.name}</p>
                                            <p className="text-sm text-gray-400">
                                                {new Date(session.date).toLocaleDateString('ja-JP')}
                                            </p>
                                            <p className="text-sm text-gray-400">
                                                {(session.recordings || []).length}ÂÄã„ÅÆÈå≤Èü≥
                                            </p>
                                        </div>
                                        <button
                                            onClick={(e) => {
                                                e.stopPropagation();
                                                deleteSession(session.id);
                                            }}
                                            className="text-red-400 hover:text-red-300 text-sm mt-2"
                                        >
                                            ÂâäÈô§
                                        </button>
                                    </div>
                                ))}
                            </div>
                        </div>

                        <div className="glass-card p-6 lg:col-span-2">
                            <h2 className="text-xl font-bold mb-4">Èü≥Ê∫êÁÆ°ÁêÜ</h2>
                            
                            {currentSession ? (
                                <>
                                    {isFirebaseEnabled && (
                                        <div className="upload-method-selector">
                                            <label>
                                                <input 
                                                    type="radio" 
                                                    value="auto" 
                                                    checked={uploadMethod === 'auto'}
                                                    onChange={(e) => setUploadMethod(e.target.value)}
                                                />
                                                Ëá™ÂãïÔºà10MB‰ª•‰∏ã„ÅØÁõ¥Êé•„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÔºâ
                                            </label>
                                            <label>
                                                <input 
                                                    type="radio" 
                                                    value="firebase" 
                                                    checked={uploadMethod === 'firebase'}
                                                    onChange={(e) => setUploadMethod(e.target.value)}
                                                />
                                                Â∏∏„Å´Firebase„Å´„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ
                                            </label>
                                            <label>
                                                <input 
                                                    type="radio" 
                                                    value="link" 
                                                    checked={uploadMethod === 'link'}
                                                    onChange={(e) => setUploadMethod(e.target.value)}
                                                />
                                                Â§ñÈÉ®„É™„É≥„ÇØ„Çí‰ΩøÁî®
                                            </label>
                                        </div>
                                    )}
                                    
                                    <div 
                                        className={`drop-zone ${dragOver ? 'drag-over' : ''}`}
                                        onDrop={handleDrop}
                                        onDragOver={(e) => {
                                            e.preventDefault();
                                            setDragOver(true);
                                        }}
                                        onDragLeave={() => setDragOver(false)}
                                    >
                                        {uploading ? (
                                            <p>„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ‰∏≠...</p>
                                        ) : (
                                            <>
                                                <p className="text-lg mb-2">Èü≥Â£∞„Éï„Ç°„Ç§„É´„Çí„Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„Éó</p>
                                                <p className="text-sm text-gray-400 mb-4">„Åæ„Åü„ÅØ</p>
                                                <div className="flex gap-4 justify-center">
                                                    {isFirebaseEnabled && (
                                                        <>
                                                            <input
                                                                ref={fileInputRef}
                                                                type="file"
                                                                accept="audio/*"
                                                                multiple
                                                                onChange={handleFileInput}
                                                                style={{ display: 'none' }}
                                                            />
                                                            <button 
                                                                onClick={() => fileInputRef.current?.click()}
                                                                className="btn-primary"
                                                            >
                                                                „Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû
                                                            </button>
                                                        </>
                                                    )}
                                                    <button 
                                                        onClick={() => setShowLinkModal(true)}
                                                        className="btn-primary"
                                                    >
                                                        Â§ñÈÉ®„É™„É≥„ÇØ„ÇíËøΩÂä†
                                                    </button>
                                                </div>
                                            </>
                                        )}
                                    </div>
                                    
                                    <div className="mt-6">
                                        <h3 className="text-lg font-semibold mb-3">Èü≥Ê∫ê„É™„Çπ„Éà</h3>
                                        {audioSources.length === 0 ? (
                                            <p className="text-gray-400">„Åæ„Å†Èü≥Ê∫ê„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>
                                        ) : (
                                            audioSources.map((source, index) => (
                                                <div key={index} className="audio-source-item">
                                                    <div>
                                                        <p className="font-medium">{source.name}</p>
                                                        <p className="text-sm text-gray-400">
                                                            {source.type === 'firebase' 
                                                                ? `Firebase (${(source.size / 1024 / 1024).toFixed(1)}MB)`
                                                                : source.type.replace('_', ' ')
                                                            }
                                                        </p>
                                                    </div>
                                                    <div className="flex gap-2">
                                                        {source.url && (
                                                            <a 
                                                                href={source.url} 
                                                                target="_blank" 
                                                                rel="noopener noreferrer"
                                                                className="text-purple-400 hover:text-purple-300"
                                                            >
                                                                ÂÜçÁîü
                                                            </a>
                                                        )}
                                                        <button
                                                            onClick={() => deleteAudioSource(index)}
                                                            className="text-red-400 hover:text-red-300"
                                                        >
                                                            ÂâäÈô§
                                                        </button>
                                                    </div>
                                                </div>
                                            ))
                                        )}
                                    </div>
                                </>
                            ) : (
                                <p className="text-center text-gray-400 py-8">
                                    „Çª„ÉÉ„Ç∑„Éß„É≥„ÇíÈÅ∏Êäû„Åæ„Åü„ÅØ‰ΩúÊàê„Åó„Å¶„Åè„Å†„Åï„ÅÑ
                                </p>
                            )}
                        </div>
                    </div>

                    {showLinkModal && (
                        <div className="modal-overlay" onClick={() => setShowLinkModal(false)}>
                            <div className="modal-content glass-card" onClick={(e) => e.stopPropagation()}>
                                <h3 className="text-xl font-bold mb-4">Â§ñÈÉ®„É™„É≥„ÇØ„ÇíËøΩÂä†</h3>
                                
                                <input
                                    type="text"
                                    placeholder="Èü≥Ê∫ê„ÅÆÂêçÂâç"
                                    value={externalLinkName}
                                    onChange={(e) => setExternalLinkName(e.target.value)}
                                    className="input-field"
                                />
                                
                                <input
                                    type="url"
                                    placeholder="URL (Google Drive, YouTube, SoundCloud „Å™„Å©)"
                                    value={externalLink}
                                    onChange={(e) => setExternalLink(e.target.value)}
                                    className="input-field"
                                />
                                
                                <div className="text-sm text-gray-400 mb-4">
                                    <p>ÂØæÂøú„Çµ„Éº„Éì„Çπ:</p>
                                    <ul className="list-disc list-inside ml-2">
                                        <li>Google Drive (ÂÖ±Êúâ„É™„É≥„ÇØ)</li>
                                        <li>YouTube</li>
                                        <li>SoundCloud</li>
                                        <li>„Åù„ÅÆ‰ªñ„ÅÆÁõ¥Êé•„É™„É≥„ÇØ</li>
                                    </ul>
                                </div>
                                
                                <div className="flex gap-4">
                                    <button
                                        onClick={handleExternalLinkAdd}
                                        className="btn-primary flex-1"
                                    >
                                        ËøΩÂä†
                                    </button>
                                    <button
                                        onClick={() => {
                                            setShowLinkModal(false);
                                            setExternalLink('');
                                            setExternalLinkName('');
                                        }}
                                        className="btn-secondary flex-1"
                                    >
                                        „Ç≠„É£„É≥„Çª„É´
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<StudioApp />);
        //]]>
    </script>
</body>
</html>
